#!/usr/bin/env bash
#
# Conventional Commits validator
# https://www.conventionalcommits.org/
#
# Format: type(scope)?: description
#
# Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
# Scope: optional, in parentheses
# Description: starts after colon and space
#
# Examples:
#   feat: add user authentication
#   fix(api): resolve null pointer exception
#   docs: update README with examples
#   feat!: breaking change in API
#

commit_msg_file="$1"
commit_msg=$(head -n 1 "$commit_msg_file")

# Conventional commits regex pattern
# type(scope)?!?: description
pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-zA-Z0-9_-]+\))?\!?: .+"

if [[ ! "$commit_msg" =~ $pattern ]]; then
    echo ""
    echo "❌ Invalid commit message format!"
    echo ""
    echo "Your message: \"$commit_msg\""
    echo ""
    echo "Expected format: type(scope)?: description"
    echo ""
    echo "Valid types:"
    echo "  feat     - A new feature (MINOR version bump)"
    echo "  fix      - A bug fix (PATCH version bump)"
    echo "  docs     - Documentation only changes"
    echo "  style    - Code style changes (formatting, semicolons, etc)"
    echo "  refactor - Code changes that neither fix bugs nor add features"
    echo "  perf     - Performance improvements"
    echo "  test     - Adding or correcting tests"
    echo "  build    - Build system or external dependency changes"
    echo "  ci       - CI configuration changes"
    echo "  chore    - Other changes that don't modify src or test files"
    echo "  revert   - Reverts a previous commit"
    echo ""
    echo "Examples:"
    echo "  feat: add login button"
    echo "  fix(auth): resolve token expiration issue"
    echo "  docs: update API documentation"
    echo "  feat!: breaking change in user API"
    echo ""
    exit 1
fi

echo "✓ Commit message follows conventional commits format"
